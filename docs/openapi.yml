openapi: 3.1.0
info:
  title: OpenAPI definition
  version: v1

servers:
  - url: http://127.0.0.1:8080/api/v1

tags:
  - name: Auth
  - name: User
  - name: Cards

security:
  - accessCookieAuth: [ ]
    refreshCookieAuth: [ ]

paths:
  /auth/register:
    post:
      tags:
        - Auth
      operationId: register
      summary: Registers a new user
      security: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
      responses:
        '201':
          description: User successfully registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserView'
        '400':
          $ref: '#/components/responses/BadRequestError'
  /auth/login:
    post:
      tags:
        - Auth
      operationId: login
      security: [ ]
      summary: Logs in user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLogin'
      responses:
        '200':
          description: User successfully logged in
        '404':
          $ref: '#/components/responses/NotFoundError'
  /auth/logout:
    get:
      tags:
        - Auth
      operationId: logout
      summary: Logs out user
      security: [ ]
      responses:
        '200':
          description: User successfully logged out
        '404':
          $ref: '#/components/responses/NotFoundError'
  /users:
    get:
      tags:
        - User
      operationId: getUsers
      summary: Gets all users
      parameters:
        - $ref: '#/components/parameters/pageParam'
        - $ref: '#/components/parameters/sizeParam'
        - $ref: '#/components/parameters/sortParam'
        - name: email
          in: query
          required: false
          schema:
            type: string
            format: email
        - name: first_name
          in: query
          required: false
          schema:
            type: string
        - name: last_name
          in: query
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Get list of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserView'
        '404':
          $ref: '#/components/responses/NotFoundError'
  /user/{uuid}:
    get:
      tags:
        - User
      operationId: getUser
      parameters:
        - $ref: '#/components/parameters/uuidParamInPath'
      responses:
        '200':
          description: User found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserView'
        '404':
          $ref: '#/components/responses/NotFoundError'
    patch:
      summary: Patches User by UUID
      tags:
        - User
      operationId: patchUser
      parameters:
        - $ref: '#/components/parameters/uuidParamInPath'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserPatch'
      responses:
        '200':
          description: User patched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserView'
        '404':
          $ref: '#/components/responses/NotFoundError'
    delete:
      summary: Delete User by UUID
      tags:
        - User
      operationId: deleteUser
      parameters:
        - $ref: '#/components/parameters/uuidParamInPath'
      responses:
        '204':
          description: User deleted successfully
        '404':
          $ref: '#/components/responses/NotFoundError'
  /workspaces:
    get:
      summary: Get list of workspaces
      tags:
        - Workspace
      operationId: getWorkspaces
      parameters:
        - $ref: '#/components/parameters/pageParam'
        - $ref: '#/components/parameters/sizeParam'
        - $ref: '#/components/parameters/sortParam'
        - $ref: '#/components/parameters/uuidParamInQuery'
          description: Filter by user UUID
        - name: project_id
          in: query
          required: false
          schema:
            $ref: '#/components/schemas/id'
          description: Filter by project ID
        - name: name
          in: query
          schema:
            type: string
          description: Filter by workspace name (substring match)
      responses:
        '200':
          description: List of workspaces retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WorkspaceView'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
  /user/{uuid}/workspaces:
    post:
      summary: Create a new workspace related with User
      tags:
        - Workspace
      operationId: addWorkspace
      parameters:
        - $ref: '#/components/parameters/uuidParamInPath'
          description: UUID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkspaceCreate'
      responses:
        '201':
          description: Workspace created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkspaceView'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
  /workspace/{id}:
    get:
      summary: Get workspace by ID
      tags:
        - Workspace
      operationId: getWorkspace
      parameters:
        - $ref: '#/components/parameters/idParamInPath'
          description: Workspace ID
      responses:
        '200':
          description: Workspace data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkspaceView'
        '404':
          $ref: '#/components/responses/NotFoundError'
    patch:
      summary: Patch workspace by ID
      tags:
        - Workspace
      operationId: patchWorkspace
      parameters:
        - $ref: '#/components/parameters/idParamInPath'
          description: Workspace ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkspacePatch'
      responses:
        '200':
          description: Workspace patched successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkspaceView'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
    delete:
      summary: Delete workspace by ID
      tags:
        - Workspace
      operationId: deleteWorkspace
      parameters:
        - $ref: '#/components/parameters/idParamInPath'
          description: Workspace ID
      responses:
        '204':
          description: Workspace deleted successfully
        '404':
          $ref: '#/components/responses/NotFoundError'

components:
  securitySchemes:
    accessCookieAuth:
      type: apiKey
      in: cookie
      name: access_token
    refreshCookieAuth:
      type: apiKey
      in: cookie
      name: refresh_token

  parameters:
    idParamInPath:
      name: id
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/id'
    uuidParamInPath:
      name: uuid
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/uuid'
    uuidParamInQuery:
      name: uuid
      in: query
      required: false
      schema:
        $ref: '#/components/schemas/uuid'
    pageParam:
      name: page
      in: query
      schema:
        type: integer
        minimum: 0
      description: Page number (starting from 0)
    sizeParam:
      name: size
      in: query
      schema:
        type: integer
        minimum: 1
      description: Number of elements per page
    sortParam:
      name: sort
      in: query
      schema:
        type: string
        example: created_at:asc
      description: |
        MultiSort by a fields and directions.
        Format: `field1:direction1,field2:direction2,..`.
        Allowed fields: `id`, `created_at`, other (depends on entity fields).
        Allowed directions: `asc`, `desc`.

  responses:
    BadRequestError:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiError'
    UnauthorizedError:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiError'
    ForbiddenError:
      description: Invalid authentication credentials
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiError'
    NotFoundError:
      description: Element is not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiError'

  schemas:
    ApiError:
      type: object
      description: Standardized error response returned by API when something goes wrong
      required:
        - status
        - error
        - message
        - path
        - timestamp
      properties:
        status:
          type: integer
          format: int32
          description: HTTP status code of the error
          example: 404
        error:
          type: string
          description: HTTP error reason phrase
          example: Not Found
        message:
          type: string
          description: Human-readable error message explaining what went wrong
          example: Requested resource was not found
        path:
          type: string
          description: API endpoint path where the error occurred
          example: /api/v1/auth/register
        timestamp:
          type: string
          format: date-time
          description: Timestamp when the error occurred in ISO-8601 format
          example: 2025-10-01T12:00:00.000Z
    TimeData:
      type: object
      required:
        - createdAt
        - updatedAt
      properties:
        created_at:
          type: string
          format: date-time
          example: '2025-10-18T09:00:00Z'
        updated_at:
          type: string
          format: date-time
          example: '2025-10-18T09:30:00Z'

    UserBase:
      type: object
      properties:
        email:
          type: string
          format: email
          example: user@example.com
          maxLength: 320
        first_name:
          type: string
          example: John
          maxLength: 128
        last_name:
          type: string
          example: Doe
          maxLength: 128
    UserCreate:
      type: object
      required:
        - email
        - password
        - first_name
        - last_name
      properties:
        first_name:
          $ref: '#/components/schemas/UserBase/properties/first_name'
        last_name:
          $ref: '#/components/schemas/UserBase/properties/last_name'
        email:
          $ref: '#/components/schemas/UserBase/properties/email'
        password:
          type: string
          format: password
          example: StrongPassword123!
          pattern: ^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*]).{8,}$
        roles:
          type: array
          items:
            $ref: '#/components/schemas/UserRole'
          uniqueItems: true
    UserPatch:
      type: object
      properties:
        first_name:
          $ref: '#/components/schemas/UserBase/properties/first_name'
        last_name:
          $ref: '#/components/schemas/UserBase/properties/last_name'
    UserView:
      allOf:
        - $ref: '#/components/schemas/UserBase'
        - type: object
          properties:
            uuid:
              $ref: '#/components/schemas/uuid'
            email:
              $ref: '#/components/schemas/UserBase/properties/email'
            first_name:
              $ref: '#/components/schemas/UserBase/properties/first_name'
            last_name:
              $ref: '#/components/schemas/UserBase/properties/last_name'
            role:
              $ref: '#/components/schemas/UserRole'
            created_at:
              $ref: '#/components/schemas/TimeData/properties/created_at'
            updated_at:
              $ref: '#/components/schemas/TimeData/properties/updated_at'
    UserLogin:
      type: object
      required:
        - email
        - password
      properties:
        email:
          $ref: '#/components/schemas/UserBase/properties/email'
        password:
          type: string
          format: password
          example: StrongPassword123!
          maxLength: 255
          minLength: 8
    UserRole:
      type: string
      enum:
        - ROLE_USER
        - ROLE_ADMIN
    JwtTokens:
      type: object
      required:
        - access
        - refresh
      properties:
        access:
          type: string
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImlhdCI6MTUxNjIzOTAyMn0.KMUFsIDTnFmyG3nMiGM6H9FNFUROf3wh7SmqJp-QV30
        refresh:
          type: string
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImlhdCI6MTUxNjIzOTAyMn0.KMUFsIDTnFmyG3nMiGM6H9FNFUROf3wh7SmqJp-QV30

    WorkspaceBase:
      type: object
      properties:
        name:
          type: string
          maxLength: 128
          description: Name of the workspace
          example: Development Team
        description:
          type: string
          maxLength: 1024
          description: Description of the workspace
          example: Workspace for the backend development team
    WorkspaceCreate:
      allOf:
        - $ref: '#/components/schemas/WorkspaceBase'
        - type: object
          required:
            - name
          properties:
            name:
              $ref: '#/components/schemas/WorkspaceBase/properties/name'
    WorkspaceView:
      allOf:
        - $ref: '#/components/schemas/TimeData'
        - $ref: '#/components/schemas/WorkspaceBase'
        - type: object
    WorkspacePatch:
      allOf:
        - $ref: '#/components/schemas/WorkspaceBase'
        - type: object
          description: All fields optional for partial update

    id:
      type: integer
      format: int64
      minimum: 1
      example: 1
    uuid:
      type: string
      format: uuid
      example: a11cb8a8-7f6c-49cf-9e10-192556941ec3
